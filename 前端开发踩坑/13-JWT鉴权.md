### 1、什么是JWT
侠义来说，JWT就是一段用户信息。这段用户信息，可以存储在浏览器，然后每次发起请求时，像cookie一样带给服务端；也可以存储更多的用户信息，来替代服务端sessions，减小服务端查询的压力。

后端接口，对用户请求进行鉴权，使用JWT 。

在整个鉴权当中，前后端都需要做。前端需要隐藏对用户不应当可见的组件。而后端需要防止各种意外情况，所以后端同样需要鉴权。

JWT ，json wen token ，是一种认证的格式。包括三部分：

* header：头部，用来存放 JWT 的类型，和编码格式。通常base64格式
* payload：信息存放的位置。用来存放信息
* signature：签名信息，包含了header、payload、secret_key 等综合信息
* secret_key 是密钥，存放在服务端

用户在前端登录时，由后端生成 JWT，然后返回给前端，前端存放在本地。

然后每次发起请求时，都在约定好的请求头内，加入存放的JWT。

如果后端鉴权成功，则返回数据；如果后端鉴权失败，则按照约定返回错误信息，然后前端处理，对本地存储的JWT进行清理，或者刷新（可以存两个token，一个用来刷新，一个用来存放真正的token）。

所以，前端一般是只有在登录时，才会存下 两个token（一个存放信息的，一个存放刷新时间的）。然后其他时候，都是请求时，给后端返回token。

在任何发生错误的情况下，都重新刷新页面。在router是history的情况下，刷新页面，会回到首页，然后再次进行登录。
### 2、前后端基于JWT的请求流程
* 前端，使用用户名和密码进行登录请求
* 后端，校验用户信息，如果登录成功，生成一个JWT对象，和用户信息，并且返回给前端
* 前端，接受返回的JWT，如果登录成功，就将JWT存储起来，同时根据业务需要，存储其他用户信息
* 前端，在向后端发送任何请求之前，都使用一个约定的请求头，把本地存储的JWT带上，没有就带个空的
* 后端，从约定的请求头中，取出JWT，解析后校验用户信息，判断该请求是否具有操作权限
* 前端，在任意响应返回后，都校验返回值，判断是否已经没有了权限，如果失去权限，就跳转到指定的页面，或者根据后端的返回值来跳转
### 3、前端的导航守卫
在不发起网络请求的情况下，前端需要在每次导航时，都进行用户状态检测。
* 导航时，使用前置守卫，判断用户是否登录
* 已登录，继续跳转
* 未登录，请求后端登录状态查询接口
* 查询接口返回为已登录状态，则继续跳转；否则跳转到指定页。
